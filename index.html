<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Liga de Baloncesto Persistente</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
textarea { width: 100%; height: 100px; margin-bottom: 10px; }
button { margin: 5px; padding: 10px; }
h2 { margin-top: 20px; }
ul { list-style: none; padding: 0; }
li { margin: 3px 0; }
.equipo { display: inline-block; width: 45%; vertical-align: top; }
</style>
</head>
<body>

<h1>Liga de Baloncesto Automática</h1>

<h2>Lista de jugadores (marcar invitados con "(invitado)")</h2>
<textarea id="lista"></textarea>
<br>
<button onclick="cargarLista()">Cargar lista</button>
<button onclick="siguientePartido()">➡️ Siguiente Partido</button>
<button onclick="ganaA()">Gana Equipo A</button>
<button onclick="ganaB()">Gana Equipo B</button>

<h2>Partido #<span id="nPartido">0</span></h2>

<div class="equipo">
<h3>Equipo A</h3>
<ul id="equipoA"></ul>
</div>

<div class="equipo">
<h3>Equipo B</h3>
<ul id="equipoB"></ul>
</div>

<script>
let colaLiga = [];
let colaInvitados = [];
let campeon = []; // equipo que ganó 2 consecutivos
let ultimoEnCancha = new Set();
let modo='normal'; // normal o standby
let A=[], B=[];
let nPartido=0;
let consecutivosA=0;
let consecutivosB=0;

function cargarLista(){
  const lines = document.getElementById('lista').value.split('\n').map(l=>l.trim()).filter(l=>l);
  colaLiga = [];
  colaInvitados = [];
  lines.forEach(j=>{
    if(j.toLowerCase().includes('(invitado)')){
      colaInvitados.push(j);
    }else{
      colaLiga.push(j);
    }
  });
  alert("Lista cargada: "+lines.length+" jugadores");
}

// Tomar n jugadores de la cola sin repetir los que están en ex
function tomar(cola,n,ex=new Set()){
  const seleccion=[];
  let i=0;
  while(seleccion.length<n){
    if(cola.length===0) break;
    const jugador=cola.shift();
    if(!ex.has(jugador)){
      seleccion.push(jugador);
      ex.add(jugador);
    }
    cola.push(jugador); // vuelta a la cola para bucle infinito
    i++;
    if(i>cola.length*2) break; // seguridad
  }
  return seleccion;
}

// Generar equipos del partido según reglas
function generarEquipos(){
  let ex=new Set([...ultimoEnCancha, ...campeon]);
  if(nPartido===1){
    // primer partido: 10 de la liga
    const primeros = tomar(colaLiga,10,ex);
    A=primeros.slice(0,5);
    B=primeros.slice(5,10);
  } else if(modo==='standby'){
    // equipo ganador en standby ya está en campeon
    const nuevos = retador();
    if(consecutivosA>=2){
      B = nuevos;
      A = campeon;
    } else if(consecutivosB>=2){
      A = nuevos;
      B = campeon;
    } else {
      A = nuevos.slice(0,5);
      B = nuevos.slice(5,10);
    }
  } else {
    // partidos normales: 3 liga + 2 invitados cada equipo
    const nuevos = retador();
    A = nuevos.slice(0,5);
    B = nuevos.slice(5,10);
  }
  ultimoEnCancha = new Set([...A,...B]);
  mostrarEquipos();
}

function retador(){
  let ex=new Set([...ultimoEnCancha, ...campeon]);
  let equipo = [];
  // intentamos sacar 3 liga y 2 invitados para cada equipo
  const L = tomar(colaLiga,6,ex);
  const I = tomar(colaInvitados,4,ex);
  equipo = [...L,...I];
  // si no alcanza 10, completamos con lo que haya
  while(equipo.length<10){
    equipo.push(...tomar([...colaLiga,...colaInvitados],10-equipo.length,ex));
  }
  return equipo;
}

function mostrarEquipos(){
  document.getElementById('equipoA').innerHTML = A.map(j=>"<li>"+j+"</li>").join('');
  document.getElementById('equipoB').innerHTML = B.map(j=>"<li>"+j+"</li>").join('');
  document.getElementById('nPartido').textContent = nPartido;
}

function siguientePartido(){
  nPartido++;
  generarEquipos();
}

// marcar ganador
function ganaA(){
  if(A.toString()===campeon.toString()){
    consecutivosA++;
  } else {
    consecutivosA=1;
  }
  consecutivosB=0;
  actualizarColas('A');
}

function ganaB(){
  if(B.toString()===campeon.toString()){
    consecutivosB++;
  } else {
    consecutivosB=1;
  }
  consecutivosA=0;
  actualizarColas('B');
}

function actualizarColas(ganador){
  let perdedor = ganador==='A'?B:A;
  // los perdedores van al final de su cola según sean liga o invitados
  perdedor.forEach(p=>{
    if(colaLiga.includes(p) || colaInvitados.includes(p)){
      // ya está en cola, no mover
    } else if(p.toLowerCase().includes('(invitado)')){
      colaInvitados.push(p);
    } else {
      colaLiga.push(p);
    }
  });

  // actualizar campeón si ganó 2 consecutivos
  if(consecutivosA>=2){
    campeon = A;
    modo='standby';
  } else if(consecutivosB>=2){
    campeon = B;
    modo='standby';
  } else {
    campeon=[];
    modo='normal';
  }
}
</script>

</body>
</html>
  