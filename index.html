<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèÄ Liga Autom√°tica de Baloncesto</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #0e0e0e;
  color: #f1f1f1;
  margin: 0;
  padding: 20px;
}
h1, h2 {
  text-align: center;
  color: #ffb100;
}
textarea {
  width: 100%;
  height: 200px;
  background: #1c1c1c;
  color: #f1f1f1;
  border: 1px solid #555;
  border-radius: 5px;
  padding: 10px;
  resize: vertical;
}
button {
  background: #ffb100;
  border: none;
  color: #000;
  padding: 10px 20px;
  margin: 5px;
  font-weight: bold;
  cursor: pointer;
  border-radius: 4px;
}
button:hover {
  background: #ffd54f;
}
.container {
  max-width: 1000px;
  margin: auto;
}
.section {
  background: #1c1c1c;
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 20px;
  box-shadow: 0 0 10px #000;
}
.list, .team {
  background: #222;
  padding: 10px;
  margin-top: 8px;
  border-radius: 5px;
  border: 1px solid #333;
}
.team-title {
  font-weight: bold;
  color: #ffb100;
}
.status {
  background: #111;
  padding: 10px;
  border-radius: 5px;
  border: 1px solid #333;
}
</style>
</head>
<body>

<h1>üèÄ Sistema Autom√°tico - Liga de Baloncesto</h1>

<div class="container">

  <div class="section">
    <h2>1Ô∏è‚É£ Ingresar Lista de Jugadores</h2>
    <p>Marca con <b>(invitado)</b> a los invitados.</p>
    <textarea id="inputList" placeholder="Ejemplo:&#10;1. L√°piz Conciente&#10;2. Future (invitado)"></textarea><br>
    <button onclick="loadPlayers()">Cargar Listas</button>
    <div id="lists"></div>
  </div>

  <div class="section">
    <h2>2Ô∏è‚É£ Simulaci√≥n de Partidos</h2>
    <button onclick="nextMatch()">‚ûú Armar pr√≥ximo partido</button>
    <button onclick="selectWinner('A')">üèÜ Gana Equipo A</button>
    <button onclick="selectWinner('B')">üèÜ Gana Equipo B</button>
    <div id="match"></div>
  </div>

  <div class="section status" id="status">Estado del sistema...</div>

</div>

<script>
let league = [];
let guests = [];
let championTeam = [];
let standbyChampion = null;
let standbyMode = false;
let standbyCount = 0;
let matchNumber = 0;

let currentTeams = {A:[], B:[], desc:""};

function loadPlayers(){
  const text = document.getElementById("inputList").value.trim();
  const lines = text.split(/\n/).map(l=>l.replace(/^\d+\.\s*/,'').trim()).filter(Boolean);
  league = [];
  guests = [];
  for (let name of lines){
    if (name.toLowerCase().includes("(invitado)")) {
      guests.push(name.replace(/\(invitado\)/i,"").trim());
    } else league.push(name);
  }
  championTeam = [];
  standbyChampion = null;
  standbyMode = false;
  standbyCount = 0;
  matchNumber = 0;
  updateLists();
  showStatus("‚úÖ Listas cargadas correctamente.");
}

function updateLists(){
  document.getElementById("lists").innerHTML = `
  <div class='list'><b>üèÄ Liga:</b> ${league.join(", ")}</div>
  <div class='list'><b>üåê Invitados:</b> ${guests.join(", ")}</div>
  `;
}

function getNextFrom(arr, n){
  const out = [];
  for (let i=0;i<n;i++){
    if (arr.length===0) break;
    out.push(arr.shift());
  }
  return out;
}

function getNextPlayers(n){
  const out=[];
  while(out.length<n){
    if (league.length>0) out.push(league.shift());
    else if (guests.length>0) out.push(guests.shift());
    else break;
  }
  return out;
}

function nextMatch(){
  let teamA=[], teamB=[], desc="";

  // STANDBY MODE ‚Üí dos equipos nuevos se enfrentan
  if (standbyMode && !standbyChampion){
    const nuevos10 = getNextPlayers(10);
    teamA = nuevos10.slice(0,5);
    teamB = nuevos10.slice(5,10);
    desc = "‚öîÔ∏è Duelo entre nuevos equipos (Campe√≥n en standby)";
    showMatch(teamA,teamB,desc);
    return;
  }

  // Duelo del campe√≥n en standby vs ganador del duelo interno
  if (standbyChampion && championTeam.length>0){
    teamA = standbyChampion;
    teamB = championTeam;
    desc = "üèÜ Duelo: Campe√≥n en standby vs Retador";
    showMatch(teamA,teamB,desc);
    return;
  }

  if (matchNumber===0){
    // primer partido con 10 primeros de la liga
    const first10 = league.splice(0,10);
    teamA = first10.slice(0,5);
    teamB = first10.slice(5,10);
    desc = "Partido 1 (Inicio de liga)";
  } else {
    // partidos normales
    if (championTeam.length>0){
      teamA = championTeam;
      let liga3 = getNextFrom(league,3);
      let inv2 = getNextFrom(guests,2);
      teamB = liga3.concat(inv2);
      desc = `Partido ${matchNumber+1}`;
    }
  }

  currentTeams = {A:teamA,B:teamB,desc};
  showMatch(teamA,teamB,desc);
  matchNumber++;
}

function showMatch(teamA,teamB,desc){
  document.getElementById("match").innerHTML = `
    <h3>${desc}</h3>
    <div class='team'><span class='team-title'>Equipo A:</span> ${teamA.join(", ")}</div>
    <div class='team'><span class='team-title'>Equipo B:</span> ${teamB.join(", ")}</div>
  `;
}

function selectWinner(side){
  const winner = currentTeams[side];
  const loser = side==='A' ? currentTeams['B'] : currentTeams['A'];

  // Caso 1: duelo interno durante modo standby
  if (standbyMode && !standbyChampion){
    championTeam = winner;
    showStatus(`üèÄ ${side==='A'?'Equipo A':'Equipo B'} gana el duelo interno y ser√° el retador del campe√≥n en standby.`);
    return;
  }

  // Caso 2: duelo entre campe√≥n standby y nuevo campe√≥n interno
  if (standbyChampion){
    if (side==='A'){
      championTeam = standbyChampion;
      showStatus("üèÜ El campe√≥n en standby regresa invicto como campe√≥n activo.");
    } else {
      championTeam = winner;
      showStatus("üí• El campe√≥n en standby fue derrotado. Nuevo campe√≥n activo.");
    }
    standbyChampion = null;
    standbyMode = false;
    standbyCount = 0;
    updateLists();
    return;
  }

  // Caso 3: flujo normal
  if (championTeam.length===0){
    championTeam = winner;
    standbyCount = 1;
  } else if (arraysEqual(winner,championTeam)){
    standbyCount++;
  } else {
    championTeam = winner;
    standbyCount = 1;
  }

  moverPerdedores(loser);

  if (standbyCount>=2){
    standbyChampion = championTeam;
    championTeam = [];
    standbyMode = true;
    showStatus("üî• Campe√≥n gana 2 veces consecutivas ‚Üí entra en standby. Se formar√°n 10 nuevos jugadores para enfrentarse entre s√≠.");
  } else {
    showStatus(`üèÄ Gana ${side==='A'?'Equipo A':'Equipo B'} ‚Üí Campe√≥n actual: ${winner.join(", ")}`);
  }

  updateLists();
}

function moverPerdedores(loser){
  for (let p of loser){
    if (guests.includes(p)||league.includes(p)) continue;
    if (p.toLowerCase().includes("(invitado)") || /future|drake|kendrick|lil/i.test(p))
      guests.push(p);
    else league.push(p);
  }
}

function arraysEqual(a,b){
  return Array.isArray(a)&&Array.isArray(b)&&a.length===b.length&&a.every((v,i)=>v===b[i]);
}

function showStatus(msg){
  document.getElementById("status").innerHTML = msg;
}
</script>

</body>
</html>
